class InteractionManager{constructor(){this.observers=[],this.timeouts=new Map,this.elements={},this.isScrolling=!1,this.animationFrameId=null,this.handleScroll=this.handleScroll.bind(this),this.updateHeader=this.updateHeader.bind(this)}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupAllSystems()):this.setupAllSystems()}setupAllSystems(){try{this.cacheElements(),this.setupSmoothScrolling(),this.setupScrollHeader(),this.setupIntersectionObserver(),this.setupCardHoverEffects(),this.createFloatingElements(),this.setupMobileMenu(),this.setupDropdowns(),this.setupLazyLoading(),this.setupFormEnhancements(),console.log("InteractionManager: All systems initialized successfully")}catch(e){console.error("InteractionManager: Initialization failed:",e)}}cacheElements(){this.elements={header:document.querySelector(".site-header"),mobileToggle:document.querySelector(".mobile-toggle"),navMenu:document.querySelector(".nav-menu"),heroes:document.querySelectorAll(".hero"),forms:document.querySelectorAll("form"),cards:document.querySelectorAll(".pillar-card"),dropdowns:document.querySelectorAll(".dropdown")}}setupSmoothScrolling(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const r=e.getAttribute("href"),s=document.querySelector(r);if(s){const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches;s.scrollIntoView({behavior:e?"auto":"smooth",block:"start",inline:"nearest"}),history.pushState(null,"",r),s.focus({preventScroll:!0})}})})}setupIntersectionObserver(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return void document.querySelectorAll(".fade-in, .slide-in").forEach(e=>{e.classList.add("visible")});const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(requestAnimationFrame(()=>{t.target.classList.add("visible")}),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".fade-in, .slide-in").forEach(t=>{e.observe(t)}),this.observers.push(e)}setupCardHoverEffects(){"ontouchstart"in window||this.elements.cards.forEach(e=>{e.style.setProperty("--hover-transform","translateY(0) scale(1) rotateY(0deg)"),e.addEventListener("mouseenter",()=>{e.style.setProperty("--hover-transform","translateY(-10px) scale(1.02) rotateY(2deg)"),e.style.transform="var(--hover-transform)"}),e.addEventListener("mouseleave",()=>{e.style.setProperty("--hover-transform","translateY(0) scale(1) rotateY(0deg)"),e.style.transform="var(--hover-transform)"}),e.addEventListener("focus",()=>{e.style.setProperty("--hover-transform","translateY(-5px) scale(1.01) rotateY(1deg)"),e.style.transform="var(--hover-transform)"}),e.addEventListener("blur",()=>{e.style.setProperty("--hover-transform","translateY(0) scale(1) rotateY(0deg)"),e.style.transform="var(--hover-transform)"})})}setupMobileMenu(){const e=document.querySelector(".mobile-toggle"),t=document.querySelector(".nav-menu");if(!e||!t)return;e.addEventListener("click",()=>{const r=t.classList.contains("active");if(t.classList.toggle("active"),e.classList.toggle("active"),document.body.classList.toggle("menu-open",!r),e.setAttribute("aria-expanded",!r),!r){const e=t.querySelector("a, button");e&&setTimeout(()=>e.focus(),100)}});t.querySelectorAll(".dropdown").forEach(e=>{const t=e.querySelector(".dropbtn"),r=e.querySelector(".dropdown-content");t&&r&&t.addEventListener("click",t=>{t.preventDefault(),e.classList.toggle("open")})}),document.addEventListener("keydown",r=>{"Escape"===r.key&&t.classList.contains("active")&&(t.classList.remove("active"),e.classList.remove("active"),document.body.classList.remove("menu-open"),e.setAttribute("aria-expanded","false"),e.focus())}),document.addEventListener("click",r=>{e.contains(r.target)||t.contains(r.target)||t.classList.contains("active")&&(t.classList.remove("active"),e.classList.remove("active"),document.body.classList.remove("menu-open"),e.setAttribute("aria-expanded","false"))})}setupFormEnhancements(){this.elements.forms.forEach(e=>{const t=e.querySelector('button[type="submit"]');if(!t)return;const r=t.textContent;e.addEventListener("submit",s=>{if(t.disabled)return void s.preventDefault();t.textContent="Sending...",t.disabled=!0,t.setAttribute("aria-busy","true"),this.timeouts.has(e)&&clearTimeout(this.timeouts.get(e));const o=setTimeout(()=>{t.textContent=r,t.disabled=!1,t.setAttribute("aria-busy","false"),this.timeouts.delete(e)},1e4);this.timeouts.set(e,o)}),e.addEventListener("reset",()=>{this.timeouts.has(e)&&(clearTimeout(this.timeouts.get(e)),this.timeouts.delete(e)),t.textContent=r,t.disabled=!1,t.setAttribute("aria-busy","false")})})}createFloatingElements(){if(window.innerWidth<768||navigator.hardwareConcurrency<4)return;window.matchMedia("(prefers-reduced-motion: reduce)").matches||this.elements.heroes.forEach(e=>{const t=document.createDocumentFragment(),r=Math.min(15,Math.floor(e.offsetWidth/100));for(let e=0;e<r;e++){const e=document.createElement("div");e.className="floating-element";const r=4*Math.random()+2,s=.3*Math.random()+.1;Object.assign(e.style,{position:"absolute",width:`${r}px`,height:`${r}px`,background:`rgba(218, 165, 32, ${s})`,borderRadius:"50%",left:100*Math.random()+"%",top:100*Math.random()+"%",animationDelay:15*Math.random()+"s",pointerEvents:"none",willChange:"transform"}),t.appendChild(e)}e.appendChild(t)})}setupLazyLoading(){const e=document.querySelectorAll("img[data-src]");if(0===e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const r=e.target,s=r.dataset.src;if(s){const e=new Image;e.onload=()=>{r.src=s,r.classList.remove("lazy"),r.classList.add("loaded")},e.onerror=()=>{r.classList.add("error"),console.warn("Failed to load image:",s)},e.src=s}t.unobserve(r)}})},{rootMargin:"50px 0px",threshold:.01});e.forEach(e=>t.observe(e)),this.observers.push(t)}setupDropdowns(){this.elements.dropdowns.forEach(e=>{const t=e.querySelector(".dropdown-trigger")||e,r=e.querySelector(".dropdown-content");if(!r)return;let s,o=!1;const n=()=>{clearTimeout(s),r.style.display="block",t.setAttribute("aria-expanded","true"),r.setAttribute("aria-hidden","false"),o=!0},i=(e=300)=>{s=setTimeout(()=>{r.style.display="none",t.setAttribute("aria-expanded","false"),r.setAttribute("aria-hidden","true"),o=!1},e)};e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",()=>i()),t.addEventListener("keydown",e=>{"Enter"===e.key||" "===e.key?(e.preventDefault(),o?i(0):n()):"Escape"===e.key&&o&&(i(0),t.focus())}),document.addEventListener("click",t=>{!e.contains(t.target)&&o&&i(0)})})}setupScrollHeader(){const e=this.elements.header;e&&(this.lastScrollTop=0,e.style.transition="transform 0.3s ease-in-out",window.addEventListener("scroll",this.handleScroll,{passive:!0}))}handleScroll(){this.isScrolling||(this.isScrolling=!0,this.animationFrameId=requestAnimationFrame(this.updateHeader))}updateHeader(){const e=window.pageYOffset||document.documentElement.scrollTop,t=this.elements.header;e>this.lastScrollTop&&e>100?(t.style.transform="translateY(-100%)",t.setAttribute("data-scrolled","hidden")):(t.style.transform="translateY(0)",t.setAttribute("data-scrolled","visible")),this.lastScrollTop=e,this.isScrolling=!1}cleanup(){this.observers.forEach(e=>{e&&e.disconnect&&e.disconnect()}),this.observers=[],this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),window.removeEventListener("scroll",this.handleScroll),this.elements={},console.log("InteractionManager: Cleanup completed")}}class ContactFormHandler{constructor(e){this.form=document.getElementById(e),this.form?(this.originalText="",this.isSubmitting=!1,this.init()):console.warn(`ContactFormHandler: Form with ID "${e}" not found`)}init(){this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.setupValidation()}setupValidation(){this.form.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("blur",()=>this.validateField(e)),e.addEventListener("input",()=>this.clearFieldError(e))})}validateField(e){const t=e.value.trim(),r=e.name||e.id;let s=!0,o="";return e.hasAttribute("required")&&!t?(s=!1,o=`${r} is required`):"email"===e.type&&t&&!this.isValidEmail(t)&&(s=!1,o="Please enter a valid email address"),this.setFieldError(e,s?"":o),s}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}setFieldError(e,t){const r=e.parentNode.querySelector(".field-error");if(t)if(e.classList.add("error"),e.setAttribute("aria-invalid","true"),r)r.textContent=t;else{const r=document.createElement("div");r.className="field-error",r.textContent=t,r.setAttribute("role","alert"),e.parentNode.appendChild(r)}else e.classList.remove("error"),e.setAttribute("aria-invalid","false"),r&&r.remove()}clearFieldError(e){e.classList.remove("error"),e.setAttribute("aria-invalid","false");const t=e.parentNode.querySelector(".field-error");t&&t.remove()}async handleSubmit(e){if(e.preventDefault(),this.isSubmitting)return;if(!this.validateForm())return void showNotification("Please correct the errors in the form","error");const t=this.form.querySelector('button[type="submit"]');this.originalText=t.textContent,this.isSubmitting=!0;try{t.textContent="Sending...",t.disabled=!0,t.setAttribute("aria-busy","true");const e=new FormData(this.form);e.append("timestamp",(new Date).toISOString()),e.append("user_agent",navigator.userAgent);const r=await fetch(this.form.action||"#",{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error(`Server responded with status: ${r.status}`);showNotification((await r.json().catch(()=>({}))).message||"Message sent successfully!","success"),this.form.reset(),this.clearAllErrors()}catch(e){console.error("Form submission error:",e);let t="Failed to send message. Please try again.";"NetworkError"===e.name?t="Network error. Please check your connection and try again.":"TypeError"===e.name&&(t="Unable to connect to server. Please try again later."),showNotification(t,"error")}finally{t.textContent=this.originalText,t.disabled=!1,t.setAttribute("aria-busy","false"),this.isSubmitting=!1}}validateForm(){const e=this.form.querySelectorAll("input, textarea");let t=!0;return e.forEach(e=>{this.validateField(e)||(t=!1)}),t}clearAllErrors(){this.form.querySelectorAll("input, textarea").forEach(e=>this.clearFieldError(e))}}function showNotification(e,t="info",r=4e3){document.querySelectorAll(".notification").forEach(t=>{t.textContent===e&&t.remove()});const s=document.createElement("div");s.className=`notification notification-${t}`,s.textContent=e,s.setAttribute("role","alert"),s.setAttribute("aria-live","polite"),Object.assign(s.style,{position:"fixed",top:"20px",right:"20px",padding:"1rem 2rem",borderRadius:"8px",color:"white",fontWeight:"600",fontSize:"0.9rem",zIndex:"10000",transform:"translateX(100%)",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",maxWidth:"400px",wordWrap:"break-word"});const o={success:"#27ae60",error:"#e74c3c",warning:"#f39c12",info:"#3498db"};s.style.background=o[t]||o.info,document.body.appendChild(s),s.offsetHeight,requestAnimationFrame(()=>{s.style.transform="translateX(0)"}),setTimeout(()=>{s.style.transform="translateX(100%)",setTimeout(()=>{s.parentNode&&document.body.removeChild(s)},300)},r),s.addEventListener("click",()=>{s.style.transform="translateX(100%)",setTimeout(()=>{s.parentNode&&document.body.removeChild(s)},300)})}function initializeApp(){try{console.log("Initializing Return to the Source interactions...");const e=new InteractionManager;e.init();if(document.getElementById("contact-form")&&(new ContactFormHandler("contact-form"),console.log("Contact form handler initialized")),window.addEventListener("beforeunload",()=>{e.cleanup()}),window.performance&&console.log){const e=performance.now();console.log(`App initialization completed in ${Math.round(e)}ms`)}}catch(e){console.error("Failed to initialize app:",e),showNotification("Some interactive features may not be available","warning")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeApp):initializeApp();
//# sourceMappingURL=bundle.min.js.map